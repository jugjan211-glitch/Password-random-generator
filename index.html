<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Password Manager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .field {
      margin-bottom: 15px;
    }
    .field label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .field input, .field select {
      width: 100%;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 2px;
    }
    button.chip {
      background: #eee;
    }
    button.chip:hover {
      background: #ddd;
    }
    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-bottom: 1px solid #ccc;
    }
    .stack {
      display: flex;
      flex-direction: column;
    }
    .meta {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .name {
      font-weight: bold;
    }
    .badge {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 4px;
      background: #eee;
    }
    .muted {
      font-size: 12px;
      color: #555;
    }
    .secret {
      font-family: monospace;
      margin-top: 4px;
    }
    .btns {
      display: flex;
      gap: 4px;
    }
    #saved {
      margin-top: 20px;
    }
    #search {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Password Manager</h1>
  <div class="container">
    <div class="field">
      <label for="passwordLength">Password length</label>
      <input type="number" id="passwordLength" value="12" min="4" max="64" />
    </div>
    <div class="field">
      <label>Include</label>
      <label><input type="checkbox" id="letters" checked /> Letters</label>
      <label><input type="checkbox" id="numbers" /> Numbers</label>
      <label><input type="checkbox" id="symbols" /> Symbols</label>
    </div>
    <button id="generate">Generate Password</button>
    <div id="result"></div>
    <div class="field">
      <label for="passName">Name</label>
      <input type="text" id="passName" placeholder="e.g. Facebook" />
    </div>
    <div class="field">
      <label for="username">Username (optional)</label>
      <input type="text" id="username" placeholder="e.g. john.doe" />
    </div>
    <button id="save">Save Password</button>
    <button id="import">Import Password</button>
    <input type="text" id="search" placeholder="Search..." />
    <div id="saved"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_SENDER",
      appId: "YOUR_APPID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const genBtn = document.getElementById("generate");
    const saveBtn = document.getElementById("save");
    const importBtn = document.getElementById("import");
    const result = document.getElementById("result");
    const savedContainer = document.getElementById("saved");
    const passName = document.getElementById("passName");
    const usernameField = document.getElementById("username");
    const search = document.getElementById("search");

    function generatePassword(length, letters, numbers, symbols) {
      let chars = "";
      if (letters) chars += "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
      if (numbers) chars += "0123456789";
      if (symbols) chars += "!@#$%^&*()_+[]{}<>?,.";
      let pass = "";
      for (let i = 0; i < length; i++) {
        pass += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return pass;
    }

    function mask(str) {
      return "•".repeat(str.length);
    }

    function checkStrength(password, el) {
      let score = 0;
      if (password.length >= 8) score++;
      if (/[A-Z]/.test(password)) score++;
      if (/[0-9]/.test(password)) score++;
      if (/[^A-Za-z0-9]/.test(password)) score++;
      el.textContent = ["Weak", "Fair", "Good", "Strong"][score] || "Very Weak";
    }

    async function refreshList() {
      savedContainer.innerHTML = "";
      let arr = JSON.parse(localStorage.getItem("passwords") || "[]");
      const snap = await getDocs(collection(db, "passwords"));
      const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      const combined = [...arr, ...docs];

      const filtered = combined.filter(item =>
        item.name.toLowerCase().includes(search.value.toLowerCase())
      );

      filtered.forEach(item => {
        const row = document.createElement("div");
        row.className = "item";

        const left = document.createElement("div");
        left.className = "stack";

        const topMeta = document.createElement("div");
        topMeta.className = "meta";

        const name = document.createElement("span");
        name.className = "name";
        name.textContent = item.name;

        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = item.location;

        const strengthSpan = document.createElement("span");
        strengthSpan.className = "badge";
        const tmp = document.createElement("div");
        checkStrength(item.password || "", tmp);
        strengthSpan.textContent = tmp.textContent;

        topMeta.appendChild(name);
        topMeta.appendChild(badge);
        topMeta.appendChild(strengthSpan);

        const uname = document.createElement("span");
        uname.className = "muted";
        uname.textContent = item.username ? `Username: ${item.username}` : "Username: —";

        const pass = document.createElement("div");
        pass.className = "secret";
        let visible = false;
        pass.textContent = mask(item.password);

        left.appendChild(topMeta);
        left.appendChild(uname);
        left.appendChild(pass);

        const btns = document.createElement("div");
        btns.className = "btns";

        const toggleBtn = document.createElement("button");
        toggleBtn.className = "chip";
        toggleBtn.textContent = "👁️";
        toggleBtn.onclick = () => {
          visible = !visible;
          pass.textContent = visible ? item.password : mask(item.password);
        };

        const copyBtn = document.createElement("button");
        copyBtn.className = "chip";
        copyBtn.textContent = "📋";
        copyBtn.onclick = () => navigator.clipboard.writeText(item.password);

        const delBtn = document.createElement("button");
        delBtn.className = "chip";
        delBtn.textContent = "🗑️";
        delBtn.onclick = async () => {
          if (item.id) {
            await deleteDoc(doc(db, "passwords", item.id));
          } else {
            let arr = JSON.parse(localStorage.getItem("passwords") || "[]");
            arr = arr.filter(p => !(p.name === item.name && p.username === item.username && p.password === item.password));
            localStorage.setItem("passwords", JSON.stringify(arr));
          }
          await refreshList();
        };

        btns.appendChild(toggleBtn);
        btns.appendChild(copyBtn);
        btns.appendChild(delBtn);

        row.appendChild(left);
        row.appendChild(btns);

        savedContainer.appendChild(row);
      });
    }

    genBtn.onclick = () => {
      const len = +document.getElementById("passwordLength").value;
      const letters = document.getElementById("letters").checked;
      const numbers = document.getElementById("numbers").checked;
      const symbols = document.getElementById("symbols").checked;
      const pass = generatePassword(len, letters, numbers, symbols);
      result.textContent = pass;
      checkStrength(pass, result);
    };

    saveBtn.onclick = async () => {
      if (!result.textContent) return alert("Generate or import a password first.");
      if (!passName.value.trim()) return alert("Enter a name.");

      const choice = confirm("Save to Account (OK) or Local (Cancel)?");
      const data = { name: passName.value, username: usernameField.value, password: result.textContent, location: choice ? "Account" : "Local" };

      if (choice) {
        await addDoc(collection(db, "passwords"), data);
      } else {
        let arr = JSON.parse(localStorage.getItem("passwords") || "[]");
        arr.push(data);
        localStorage.setItem("passwords", JSON.stringify(arr));
      }
      await refreshList();
    };

    importBtn.onclick = async () => {
      const pass = prompt("Enter password");
      if (!pass) return;
      const name = prompt("Enter name");
      if (!name) return;
      const uname = prompt("Enter username (optional)");
      result.textContent = pass;
      passName.value = name;
      usernameField.value = uname || "";
      checkStrength(pass, result);
    };

    search.oninput = refreshList;
    refreshList();
  </script>
</body>
</html>
