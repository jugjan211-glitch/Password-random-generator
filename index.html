<!DOCTYPE html>
<html lang="sl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Password Manager</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h1 {
    color: #00ff99;
  }
  .container {
    background: #1e1e1e;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    width: 100%;
    max-width: 400px;
  }
  input, select {
    width: 100%;
    padding: 8px;
    margin: 5px 0 10px 0;
    border-radius: 6px;
    border: none;
  }
  button {
    background: #00ff99;
    border: none;
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    width: 100%;
    margin-top: 5px;
  }
  button:hover {
    background: #00cc77;
  }
  .result {
    margin-top: 10px;
    font-size: 1.2em;
    text-align: center;
    word-break: break-all;
  }
  #topbar {
    position: absolute;
    top: 10px;
    right: 20px;
  }
  #savedList div {
    background: #2c2c2c;
    margin: 5px 0;
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
  }
  #savedList div:hover {
    background: #3c3c3c;
  }
</style>
</head>
<body>

<div id="topbar">
  <button id="loginBtn" onclick="showLogin()">Login</button>
  <button id="logoutBtn" onclick="logout()" style="display:none;">Logout</button>
</div>

<h1>Password & Number Generator</h1>

<div class="container">
  <h2>Password Generator</h2>
  <label>Password length:</label>
  <input type="number" id="passwordLength" value="12" min="4" max="64">
  <label>Password type:</label>
  <select id="passwordType">
    <option value="letters">Letters only</option>
    <option value="lettersNumbers">Letters + Numbers</option>
    <option value="lettersNumbersSymbols">Letters + Numbers + Symbols</option>
  </select>
  <button onclick="generatePassword()">Generate Password</button>
  <div class="result" id="passwordResult"></div>
  <button onclick="savePassword()">Save Password</button>
  <button onclick="showSavedPasswords()">Saved Passwords</button>
</div>

<div class="container">
  <h2>Number Generator</h2>
  <label>Minimum:</label>
  <input type="number" id="minNumber" value="1">
  <label>Maximum:</label>
  <input type="number" id="maxNumber" value="9999">
  <button onclick="generateRandomNumber()">Generate Random Number</button>
  <div class="result" id="numberResult"></div>
</div>

<!-- Saved passwords view -->
<div class="container" id="savedPasswordsContainer" style="display:none;">
  <h2>Saved Passwords</h2>
  <input type="text" id="searchSaved" placeholder="Search..." onkeyup="searchPasswords()">
  <div id="savedList"></div>
</div>

<!-- Login form -->
<div class="container" id="loginContainer" style="display:none;">
  <h2>Login / Register</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="login()">Login</button>
  <button onclick="register()">Register</button>
</div>

<script type="module">
// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD6wyq8fLh4QiW2PP0e22I9pyACRNvSPkc",
  authDomain: "pasword-manager-d4ab6.firebaseapp.com",
  projectId: "pasword-manager-d4ab6",
  storageBucket: "pasword-manager-d4ab6.firebasestorage.app",
  messagingSenderId: "1070489046614",
  appId: "1:1070489046614:web:96f8fcd64b4a0a939e75f7",
  measurementId: "G-2MJKRG9TMN"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Auth UI logic
onAuthStateChanged(auth, (user) => {
  if (user) {
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("logoutBtn").style.display = "inline-block";
  } else {
    document.getElementById("loginBtn").style.display = "inline-block";
    document.getElementById("logoutBtn").style.display = "none";
  }
});

// Password generator
function generatePassword() {
  const length = parseInt(document.getElementById("passwordLength").value);
  const type = document.getElementById("passwordType").value;
  let chars = "";

  if (type === "letters") chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
  else if (type === "lettersNumbers") chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  else if (type === "lettersNumbersSymbols") chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?";

  let password = "";
  for (let i = 0; i < length; i++) {
    password += chars.charAt(Math.floor(Math.random() * chars.length));
  }

  document.getElementById("passwordResult").textContent = password;
}

// Random number
function generateRandomNumber() {
  const min = parseInt(document.getElementById("minNumber").value);
  const max = parseInt(document.getElementById("maxNumber").value);
  if (min > max) {
    alert("Min cannot be greater than max!");
    return;
  }
  const number = Math.floor(Math.random() * (max - min + 1)) + min;
  document.getElementById("numberResult").textContent = number;
}

// Save password
async function savePassword() {
  const user = auth.currentUser;
  if (!user) {
    alert("Please login to save passwords!");
    showLogin();
    return;
  }
  const password = document.getElementById("passwordResult").textContent;
  if (!password) {
    alert("Generate a password first!");
    return;
  }
  const name = prompt("Enter a name for this password (e.g. Google, Instagram):");
  if (!name) return;
  await addDoc(collection(db, "passwords"), {
    uid: user.uid,
    name: name,
    password: password,
    created: new Date()
  });
  alert("Password saved!");
}

// Show saved passwords
async function showSavedPasswords() {
  const user = auth.currentUser;
  if (!user) {
    alert("Please login to see saved passwords!");
    showLogin();
    return;
  }
  document.getElementById("savedPasswordsContainer").style.display = "block";
  const q = query(collection(db, "passwords"), where("uid", "==", user.uid));
  const querySnapshot = await getDocs(q);
  const savedList = document.getElementById("savedList");
  savedList.innerHTML = "";
  querySnapshot.forEach((doc) => {
    const item = document.createElement("div");
    item.textContent = doc.data().name;
    item.onclick = () => {
      navigator.clipboard.writeText(doc.data().password);
      item.textContent = doc.data().name + " (copied!)";
      setTimeout(() => {
        item.textContent = doc.data().name;
      }, 3000);
    };
    savedList.appendChild(item);
  });
}

// Search passwords
function searchPasswords() {
  const filter = document.getElementById("searchSaved").value.toLowerCase();
  const items = document.querySelectorAll("#savedList div");
  items.forEach(item => {
    if (item.textContent.toLowerCase().includes(filter)) {
      item.style.display = "block";
    } else {
      item.style.display = "none";
    }
  });
}

// Login/Register/Logout
function showLogin() {
  document.getElementById("loginContainer").style.display = "block";
}
async function login() {
  const email = document.getElementById("loginEmail").value;
  const pass = document.getElementById("loginPassword").value;
  try {
    await signInWithEmailAndPassword(auth, email, pass);
    document.getElementById("loginContainer").style.display = "none";
  } catch (e) {
    alert("Login failed: " + e.message);
  }
}
async function register() {
  const email = document.getElementById("loginEmail").value;
  const pass = document.getElementById("loginPassword").value;
  try {
    await createUserWithEmailAndPassword(auth, email, pass);
    alert("Account created!");
    document.getElementById("loginContainer").style.display = "none";
  } catch (e) {
    alert("Register failed: " + e.message);
  }
}
async function logout() {
  await signOut(auth);
  alert("Logged out!");
}
</script>

</body>
</html>
