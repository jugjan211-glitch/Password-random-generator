<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Password Manager & Random Generator</title>
<style>
  body { font-family: Arial; background:#121212; color:#fff; display:flex; flex-direction:column; align-items:center; padding:20px; }
  h1 { color:#00ff99; }
  .navbar { width:100%; max-width:400px; display:flex; justify-content:space-between; margin-bottom:20px; }
  .navbar button { width:auto; margin-left:5px; }
  .container { background:#1e1e1e; padding:20px; border-radius:12px; margin-bottom:20px; width:100%; max-width:400px; }
  input, select { width:100%; padding:8px; margin:5px 0 10px 0; border-radius:6px; border:none; }
  button { background:#00ff99; border:none; padding:10px; border-radius:6px; cursor:pointer; font-weight:bold; width:100%; }
  button:hover { background:#00cc77; }
  .result { margin-top:10px; font-size:1.2em; text-align:center; word-break:break-all; }
  #savedList button { width:100%; margin-bottom:5px; }
  /* Modal stil */
  #loginModal {
    display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5);
  }
  .modal-content {
    background:#1e1e1e; color:#fff; margin:10% auto; padding:20px; width:300px; border-radius:10px; text-align:center;
  }
  .close { float:right; cursor:pointer; font-weight:bold; font-size:20px; }
  .modal-content input { width:90%; margin:5px 0; padding:8px; border-radius:6px; border:none; }
</style>
</head>
<body>

<h1>Password Manager & Random Generator</h1>

<div class="navbar">
  <button id="loginBtn">Login</button>
  <button id="savePasswordBtn">Save Password</button>
  <button id="viewSavedBtn">Saved Passwords</button>
</div>

<div class="container">
  <h2>Password Generator</h2>
  <label>Password Length:</label>
  <input type="number" id="passwordLength" value="12" min="4" max="64">
  <label>Password Type:</label>
  <select id="passwordType">
    <option value="letters">Letters Only</option>
    <option value="lettersNumbers">Letters + Numbers</option>
    <option value="lettersNumbersSymbols">Letters + Numbers + Symbols</option>
  </select>
  <button id="generatePasswordBtn">Generate Password</button>
  <div class="result" id="passwordResult"></div>
</div>

<div class="container">
  <h2>Random Number Generator</h2>
  <label>Min:</label>
  <input type="number" id="minNumber" value="1">
  <label>Max:</label>
  <input type="number" id="maxNumber" value="9999">
  <button id="generateNumberBtn">Generate Random Number</button>
  <div class="result" id="numberResult"></div>
</div>

<div class="container" id="savedContainer" style="display:none;">
  <h2>Saved Passwords</h2>
  <div id="savedList"></div>
</div>

<!-- LOGIN MODAL -->
<div id="loginModal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button id="loginSubmitBtn">Login</button>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
// Firebase import
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD6wyq8fLh4QiW2PP0e22I9pyACRNvSPkc",
  authDomain: "pasword-manager-d4ab6.firebaseapp.com",
  projectId: "pasword-manager-d4ab6",
  storageBucket: "pasword-manager-d4ab6.appspot.com",
  messagingSenderId: "1070489046614",
  appId: "1:1070489046614:web:96f8fcd64b4a0a939e75f7",
  measurementId: "G-2MJKRG9TMN"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

// Auth state
let currentUser = null;
onAuthStateChanged(auth, (user) => {
  currentUser = user;
  document.getElementById("loginBtn").textContent = user ? "Logout" : "Login";
});

// Login / Logout
document.getElementById("loginBtn").onclick = async () => {
  if (!currentUser) {
    await signInWithPopup(auth, provider);
  } else {
    await signOut(auth);
  }
};

// Event listeners za gumb generatorjev
document.getElementById("generatePasswordBtn").addEventListener("click", generatePassword);
document.getElementById("generateNumberBtn").addEventListener("click", generateRandomNumber);

// Password Generator
function generatePassword() {
  const length = parseInt(document.getElementById("passwordLength").value);
  const type = document.getElementById("passwordType").value;
  let chars = "";
  if (type === "letters") chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
  else if (type === "lettersNumbers") chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  else chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?";
  let password = "";
  for (let i=0;i<length;i++){ password += chars.charAt(Math.floor(Math.random()*chars.length)); }
  document.getElementById("passwordResult").textContent = password;
}

// Random Number Generator
function generateRandomNumber() {
  const min = parseInt(document.getElementById("minNumber").value);
  const max = parseInt(document.getElementById("maxNumber").value);
  if (min > max) { alert("Min cannot be larger than max!"); return; }
  const number = Math.floor(Math.random()*(max-min+1))+min;
  document.getElementById("numberResult").textContent = number;
}

// Save Password
document.getElementById("savePasswordBtn").onclick = async () => {
  if (!currentUser) { alert("Please login first!"); return; }
  const password = document.getElementById("passwordResult").textContent;
  if (!password) { alert("Generate a password first!"); return; }
  const name = prompt("Enter a name for this password:");
  if (!name) return;
  await addDoc(collection(db, "passwords"), {
    uid: currentUser.uid,
    name: name,
    password: password
  });
  alert("Password saved!");
};

// View Saved Passwords
document.getElementById("viewSavedBtn").onclick = async () => {
  if (!currentUser) { alert("Please login first!"); return; }
  const savedContainer = document.getElementById("savedContainer");
  const listDiv = document.getElementById("savedList");
  listDiv.innerHTML = "";
  const q = query(collection(db,"passwords"), where("uid","==",currentUser.uid));
  const querySnapshot = await getDocs(q);
  querySnapshot.forEach(doc => {
    const btn = document.createElement("button");
    btn.textContent = doc.data().name;
    btn.onclick = () => {
      navigator.clipboard.writeText(doc.data().password);
      alert("Password copied to clipboard: "+doc.data().password);
    };
    listDiv.appendChild(btn);
  });
  savedContainer.style.display = "block";
};

// --- LOGIN MODAL ---
const modal = document.getElementById("loginModal");
const closeBtn = document.getElementById("closeModal");
const loginSubmitBtn = document.getElementById("loginSubmitBtn");

closeBtn.onclick = () => { modal.style.display = "none"; };
window.onclick = (event) => { if(event.target==modal){ modal.style.display="none"; } };

loginSubmitBtn.onclick = () => {
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;
  if(user && pass){ alert("Logged in as "+user); modal.style.display="none"; }
  else{ alert("Please fill both fields!"); }
};
</script>

</body>
</html>
