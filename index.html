<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Password Manager</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }

    .container { max-width: 800px; margin: auto; }
    .stack { display: flex; flex-direction: column; gap: 6px; }
    .row { display: flex; gap: 12px; align-items: center; margin-bottom: 12px; }
    .meta { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .badge { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 12px; }
    .btns { display: flex; gap: 8px; }
    .chip { border: none; background: #ddd; padding: 4px 8px; border-radius: 6px; cursor: pointer; }
    .chip:hover { background: #ccc; }
    .muted { color: #666; font-size: 12px; }
    .secret { font-family: monospace; }
    .item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }

    input, select { padding: 4px; }
  </style>
</head>
<body>
  <h1>Password Manager</h1>

  <div class="container">
    <div class="row">
      <button id="genBtn">Generate</button>
      <label><input type="checkbox" id="letters" checked /> Letters</label>
      <label><input type="checkbox" id="numbers" /> Numbers</label>
      <label><input type="checkbox" id="symbols" /> Symbols</label>
      <input type="number" id="length" value="12" min="4" max="64" />
    </div>

    <div class="row">
      <input type="text" id="generated" readonly />
      <button id="copyBtn">Copy</button>
    </div>

    <div class="row">
      <input type="text" id="siteName" placeholder="Name" />
      <input type="text" id="username" placeholder="Username (optional)" />
      <button id="saveBtn">Save Password</button>
    </div>

    <div class="row">
      <input type="text" id="importName" placeholder="Import name" />
      <input type="text" id="importUser" placeholder="Import username (optional)" />
      <input type="text" id="importPass" placeholder="Import password" />
      <button id="importBtn">Import</button>
    </div>

    <div class="row">
      <input type="text" id="search" placeholder="Search..." />
    </div>

    <div id="saved" class="stack"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs, deleteDoc, doc
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "123456789",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const genBtn = document.getElementById("genBtn");
    const copyBtn = document.getElementById("copyBtn");
    const saveBtn = document.getElementById("saveBtn");
    const importBtn = document.getElementById("importBtn");
    const generated = document.getElementById("generated");
    const savedContainer = document.getElementById("saved");
    const search = document.getElementById("search");

    function generatePassword(length, letters, numbers, symbols) {
      const l = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
      const n = "0123456789";
      const s = "!@#$%^&*()_-+=[]{}";
      let chars = "";
      if (letters) chars += l;
      if (numbers) chars += n;
      if (symbols) chars += s;
      if (!chars) chars = l;
      let out = "";
      for (let i = 0; i < length; i++) {
        out += chars[Math.floor(Math.random() * chars.length)];
      }
      return out;
    }

    function mask(pw) {
      return "*".repeat(pw.length);
    }

    async function refreshList() {
      savedContainer.innerHTML = "";
      let arr = JSON.parse(localStorage.getItem("passwords") || "[]");
      const snap = await getDocs(collection(db, "passwords"));
      const firebasePasswords = snap.docs.map(docSnap => ({
        id: docSnap.id,
        ...docSnap.data(),
        location: "Account"
      }));
      const localPasswords = arr.map(p => ({ ...p, location: "Local" }));
      let combined = [...firebasePasswords, ...localPasswords];
      const q = search.value.toLowerCase();
      if (q) combined = combined.filter(p => p.name.toLowerCase().includes(q));

      combined.forEach(item => {
        const row = document.createElement("div");
        row.className = "item";

        const left = document.createElement("div");
        left.className = "stack";

        const topMeta = document.createElement("div");
        topMeta.className = "meta";

        const name = document.createElement("span");
        name.className = "name";
        name.textContent = item.name;

        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = item.location;

        topMeta.appendChild(name);
        topMeta.appendChild(badge);

        const uname = document.createElement("span");
        uname.className = "muted";
        uname.textContent = item.username ? `Username: ${item.username}` : "Username: —";

        const pass = document.createElement("div");
        pass.className = "secret";
        let visible = false;
        pass.textContent = mask(item.password);

        left.appendChild(topMeta);
        left.appendChild(uname);
        left.appendChild(pass);

        const btns = document.createElement("div");
        btns.className = "btns";

        const toggleBtn = document.createElement("button");
        toggleBtn.className = "chip";
        toggleBtn.textContent = "👁️";
        toggleBtn.onclick = () => {
          visible = !visible;
          pass.textContent = visible ? item.password : mask(item.password);
        };

        const copyBtn = document.createElement("button");
        copyBtn.className = "chip";
        copyBtn.textContent = "📋";
        copyBtn.onclick = () => navigator.clipboard.writeText(item.password);

        const delBtn = document.createElement("button");
        delBtn.className = "chip";
        delBtn.textContent = "🗑️";
        delBtn.onclick = async () => {
          if (item.id) {
            await deleteDoc(doc(db, "passwords", item.id));
          } else {
            let arr = JSON.parse(localStorage.getItem("passwords") || "[]");
            arr = arr.filter(p => !(p.name === item.name && p.username === item.username && p.password === item.password));
            localStorage.setItem("passwords", JSON.stringify(arr));
          }
          await refreshList();
        };

        btns.appendChild(toggleBtn);
        btns.appendChild(copyBtn);
        btns.appendChild(delBtn);

        row.appendChild(left);
        row.appendChild(btns);

        savedContainer.appendChild(row);
      });
    }

    genBtn.onclick = () => {
      const pw = generatePassword(
        parseInt(document.getElementById("length").value),
        document.getElementById("letters").checked,
        document.getElementById("numbers").checked,
        document.getElementById("symbols").checked
      );
      generated.value = pw;
    };

    copyBtn.onclick = () => {
      navigator.clipboard.writeText(generated.value);
    };

    saveBtn.onclick = async () => {
      const name = document.getElementById("siteName").value;
      const user = document.getElementById("username").value;
      const pw = generated.value;
      if (!name || !pw) return;

      const choice = confirm("Save to Account? Cancel = Local");
      if (choice) {
        await addDoc(collection(db, "passwords"), { name, username: user, password: pw });
      } else {
        let arr = JSON.parse(localStorage.getItem("passwords") || "[]");
        arr.push({ name, username: user, password: pw });
        localStorage.setItem("passwords", JSON.stringify(arr));
      }
      await refreshList();
    };

    importBtn.onclick = async () => {
      const name = document.getElementById("importName").value;
      const user = document.getElementById("importUser").value;
      const pw = document.getElementById("importPass").value;
      if (!name || !pw) return;

      const choice = confirm("Save to Account? Cancel = Local");
      if (choice) {
        await addDoc(collection(db, "passwords"), { name, username: user, password: pw });
      } else {
        let arr = JSON.parse(localStorage.getItem("passwords") || "[]");
        arr.push({ name, username: user, password: pw });
        localStorage.setItem("passwords", JSON.stringify(arr));
      }
      await refreshList();
    };

    search.oninput = refreshList;

    refreshList();
  </script>
</body>
</html>
